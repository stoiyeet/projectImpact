'use client';

import { useSearchParams, useRouter } from 'next/navigation';
import styles from './formulas.module.css';


// Using KaTeX for beautiful math equations
import 'katex/dist/katex.min.css';
import { BlockMath } from 'react-katex';

export default function FormulasPage() {
  const searchParams = useSearchParams();
  const router = useRouter();
  const category = searchParams.get('category') || 'overview';



  const formulas = {
    overview: {
      title: "IMPACT ENERGY CALCULATIONS",
      subtitle: "Fundamental equations for asteroid impact assessment",
      debrief: "This section provides the core mathematical models used to estimate the energy released during an asteroid impact event. These equations form the basis for future calculations which depend on the energy output.",
      equations: [
        {
          title: "Meteoroid  Parameters",
          equation: "\\text{Min Asteroid Speed} \\approx 11.2\\text{ km/s} \\\\ \\text{Max Asteroid Speed} \\approx 72\\text{ km/s} \\\\ \\text{Typical Asteroid Speed} \\approx 20\\text{ km/s} \\\\ \\text{Average Asteroid Angle} \\approx 45^\\circ",
          description: "Meteroid speeds are almost always between 11.2 km/s (Earth's escape velocity) and 72 km/s (sum of Earth's orbital velocity and solar escape velocity). A slower object would accelerate as it entered earth gravitational field. A faster speed is virtually impossible as it could only come from interstellar space directly pointing at Earth. Meteroid angles can range from 0-90¬∞, but 45¬∞ is the most probable angle of impact.",
          priority: "PRIMARY"
        },
        {
          title: "Kinetic Energy",
          equation: "E = \\frac{1}{2}mv^2 = \\frac{\\pi}{12} \\, \\rho_i \\, L^3 \\, v^2 ",
          description: "Total impact energy in Joules. Mass (m) in kilograms, velocity (v) in meters per second. Alternative measurements using density (rho_i) in (kg / m^3) and diameter (L) in meters, can appoximate mass as a sphere to avoid direct mass input.",
          priority: "PRIMARY"
        },
        {
          title: "Recurrence Period",
          equation: "T_{re} = 109 \\cdot E_{Mt}^{0.78}",
          description: "Statistical frequency of impacts of magnitude E_Mt (Megatons of TNT). Measured in years between occurrences.",
          priority: "SECONDARY"
        },
        {
          title: "Impact Velocity",
          equation: "v_{impact} = \\sqrt{v_{\\infty}^2 + v_{escape}^2}",
          description: "Final velocity at impact accounting for gravitational acceleration. Earth's escape velocity: 11.2 km/s.",
          priority: "PRIMARY"
        }
      ]
    },
    thermal: {
      title: "THERMAL RADIATION EFFECTS",
      subtitle: "Heat transfer and thermal damage assessment",
      debrief: "This section covers the equations used to model the thermal radiation effects resulting from an asteroid impact. Understanding these effects is crucial for assessing potential fire hazards and burn injuries in the affected areas.",
      equations: [
        {
          title: "Fireball Radius",
          equation: "R_f = 6.1 \\times 10^{-3} \\cdot E_{Mt}^{0.4}",
          description: "Maximum extent of the thermal fireball. Radius in kilometers, energy in megatons TNT equivalent.",
          priority: "PRIMARY"
        },
        {
          title: "Thermal Flux",
          equation: "\\Phi = \\frac{f \\cdot E}{4\\pi r^2 \\cdot t}",
          description: "Thermal energy per unit area. f = radiative efficiency, E = total energy, r = distance, t = pulse duration.",
          priority: "SECONDARY"
        },
        {
          title: "Burn Radius",
          equation: "r_{burn} = \\sqrt{\\frac{f \\cdot E}{4\\pi \\cdot \\Phi_{threshold}}}",
          description: "Distance at which thermal radiation causes burns. Third-degree burns: 125 kJ/m¬≤, Second-degree: 63 kJ/m¬≤.",
          priority: "PRIMARY"
        }
      ]
    },
    blast: {
      title: "OVERPRESSURE & SHOCK WAVES",
      subtitle: "Atmospheric pressure wave propagation",
      debrief: "This section details the equations used to model the propagation of shock waves and overpressure effects generated by an asteroid impact. These models help predict structural damage and human injury risks in the vicinity of the impact.",
      equations: [
        {
          title: "Peak Overpressure",
          equation: "\\Delta P = \\frac{P_0}{(1 + \\frac{r}{r_0})^3}",
          description: "Maximum pressure above atmospheric. P‚ÇÄ = reference pressure, r = distance, r‚ÇÄ = characteristic radius.",
          priority: "PRIMARY"
        },
        {
          title: "Mach Reflection",
          equation: "P_{reflected} = 2P_{incident} \\cdot \\frac{\\gamma + 1}{\\gamma - 1}",
          description: "Pressure amplification when shock waves reflect off surfaces. Œ≥ = heat capacity ratio (‚âà1.4 for air).",
          priority: "SECONDARY"
        },
        {
          title: "Dynamic Pressure",
          equation: "q = \\frac{1}{2}\\rho v^2",
          description: "Wind pressure behind shock front. œÅ = air density, v = particle velocity. Causes structural failure.",
          priority: "SECONDARY"
        }
      ]
    },
    crater: {
      title: "CRATER FORMATION MECHANICS",
      subtitle: "Impact crater scaling and morphology",
      debrief: "This section explores the equations governing the formation and characteristics of impact craters. These models help estimate crater size, volume, and the extent of material displacement resulting from an asteroid impact.",
      equations: [
        {
          title: "Transient Crater Diameter",
          equation: "D_{tc} = 1.161\\left(\\frac{\\rho_i}{\\rho_t}\\right)^{1/3}L^{0.78}v_i^{0.44}g^{-0.22}\\sin^{1/3}\\theta",
          description: "Initial excavation diameter. œÅ·µ¢ = impactor density, œÅ‚Çú = target density, L = impactor diameter, v·µ¢ = impact velocity, Œ∏ = impact angle.",
          priority: "PRIMARY"
        },
        {
          title: "Final Crater Diameter",
          equation: "D_{fr} = \\begin{cases} 1.25D_{tc} & D_{tc} < 3.2\\text{ km} \\\\ 1.17D_{tc}^{1.13}/3200^{0.13} & D_{tc} \\geq 3.2\\text{ km} \\end{cases}",
          description: "Post-collapse crater size accounting for rim slumping and gravitational modification.",
          priority: "PRIMARY"
        },
        {
          title: "Excavated Volume",
          equation: "V = \\frac{\\pi}{24}D_{tc}^3",
          description: "Total material displaced during crater formation. Assumes parabolic crater profile.",
          priority: "SECONDARY"
        }
      ]
    },
    seismic: {
      title: "SEISMIC WAVE PROPAGATION",
      subtitle: "Global seismic response modeling",
      debrief: "This section presents the equations used to model the generation and propagation of seismic waves resulting from an asteroid impact. These models are essential for predicting ground shaking intensity and potential damage over large areas.",
      equations: [
        {
          title: "Richter Magnitude",
          equation: "M = 0.67 \\log_{10}(E) - 5.87",
          description: "Seismic magnitude scale. E = impact energy in Joules. Each unit increase = 32√ó more energy.",
          priority: "PRIMARY"
        },
        {
          title: "Ground Motion Attenuation",
          equation: "a(r) = a_0 \\cdot \\left(\\frac{r_0}{r}\\right)^n \\cdot e^{-\\alpha(r-r_0)}",
          description: "Peak ground acceleration decay. a‚ÇÄ = source acceleration, n = geometric spreading, Œ± = anelastic attenuation.",
          priority: "SECONDARY"
        },
        {
          title: "Surface Wave Magnitude",
          equation: "M_s = \\log_{10}\\left(\\frac{A}{T}\\right) + 1.66\\log_{10}(\\Delta) + 3.3",
          description: "Long-period surface wave magnitude. A = amplitude, T = period, Œî = epicentral distance in degrees.",
          priority: "SECONDARY"
        }
      ]
    }
  };

  const categoryData = formulas[category as keyof typeof formulas];

  // Handle back navigation
  const handleBack = () => {
    if (window.history.length > 1) {
      router.back();
    } else {
      router.push('/meteors');
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <button onClick={handleBack} className={styles.backButton}>
          ‚Üê RETURN
        </button>
        <div className={styles.nasaInfo}>
          <span className={styles.nasaLabel}>NASA PLANETARY DEFENSE</span>
          <span className={styles.nasaLevel}>RESEARCH</span>
        </div>
      </div>

      <div className={styles.content}>
        <div className={styles.titleSection}>
          <h1 className={styles.title}>{categoryData.title}</h1>
          <p className={styles.subtitle}>{categoryData.subtitle}</p>
          <div className={styles.warning}>
            üöÄ NOTICE: Scientific models for planetary impact assessment
          </div>
            <div className={styles.debrief}>{categoryData.debrief}</div>
        </div>
        
        <div className={styles.equationsContainer}>
          {categoryData.equations.map((eq, index) => (
            <div key={index} className={styles.equation}>
              <div className={styles.equationHeader}>
                <h2 className={styles.equationTitle}>{eq.title}</h2>
                <span className={`${styles.priority} ${styles[eq.priority.toLowerCase()]}`}>
                  {eq.priority}
                </span>
              </div>
              <div className={styles.math}>
                <BlockMath math={eq.equation} />
              </div>
              <p className={styles.description}>{eq.description}</p>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}
